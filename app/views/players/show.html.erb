<% content_for(:head) do %>
<script>
	//<![CDATA[
	$(function() {
		var name = $("#game_name"),
			date = $("#game_date"),
			hits = $("#game_hits"),
			at_bats = $("#game_at_bats"),
			singles = $("#game_singles"),
			doubles = $("#game_doubles"),
			triples = $("#game_triples"),
			homeruns = $("#game_homeruns"),
			allFields = $( [ ] ).add(name).add(date).add(hits).add(at_bats).add(singles).add(doubles).add(triples).add(homeruns),
			tips = $(".validate-tips");
		
		function updateTips(t) {
				tips.show();
				tips.text(t).addClass("ui-state-error");
		}
		
		function validateGame() {
			numHits = parseInt(singles.val())+parseInt(doubles.val())+parseInt(triples.val())+parseInt(homeruns.val());
			allFields.parent().removeClass("ui-state-error");
			tips.hide();
			
			if (at_bats.val() == "0") {
				at_bats.parent().addClass("ui-state-error");
				updateTips("You didn't enter any at bats!");
				return false;
			}
			
			if (jQuery.datepicker.parseDate('yy-mm-dd',date.val()) == null ) {
				date.parent().addClass("ui-state-error");
				updateTips("Date is required!");
				return false;
			}
			
			if (parseInt(hits.val()) > parseInt(at_bats.val())) {
				hits.parent().addClass("ui-state-error");
				at_bats.parent().addClass("ui-state-error");
				updateTips("You can't have more hits than at bats!");
				return false;
			} 
			if (parseInt(hits.val()) != numHits) {
				hits.parent().addClass("ui-state-error");
				singles.parent().addClass("ui-state-error");
				doubles.parent().addClass("ui-state-error");
				triples.parent().addClass("ui-state-error");
				homeruns.parent().addClass("ui-state-error");
				updateTips("Your number of hits doesn't add up!");
				return false;			
			} else {
				return true;
			}
		}
		
		$('#submit_game').click(function() {
			var bValid = true;

			bValid = bValid && validateGame();
			
			if (bValid) {
				$('#new_game').submit();
			}			
		});
				
		$('#show-all-games').click(function() {
			if ($('#show-all-games').text() == "Show all") {
				//All games are currently hidden
				//Show game list
				$('#all-my-games').show();
				//Change text to Hide all
				$('#show-all-games').text("Hide all")
			} else {
				$('#all-my-games').hide();
				//Change text to Show all
				$('#show-all-games').text("Show all")
			}
		});
	});
	//]]>
</script>
<% end %>

<div id="player">
	<div class="third">
		<div id="card" class="card-front">
			<div id="card-options-wrapper" class="ui-widget ui-helper-clearfix">
				<ul>
					<li class="ui-state-default ui-corner-all" title="Print your card">
						<%= link_to "Print", print_card_player_path(@player), :class => "ui-icon ui-icon-print", :target => "_blank"%>
					</li>
					<li class="ui-state-default ui-corner-all" title="Edit your info">
						<%= link_to "Edit Player", edit_player_path(@player), :class => "ui-icon ui-icon-wrench" %>
					</li>
					<li class="ui-state-default ui-corner-all" title="Change your password">
						<%= link_to "Change password", edit_player_registration_path, :class => "ui-icon ui-icon-locked" %>
					</li>					
					<li class="ui-state-default ui-corner-all" title="Upload a picture">
						<a href="#" class="ui-icon ui-icon-image">Upload image</a>
					</li>					
				</ul>
			</div>
			<% if !@player.avatar_file_name %>
				<img id="player-picture" src="/images/avatar_placeholder.png" />
			<% else %>
				<%= image_tag @player.avatar.url(:large) %>
			<% end %>
			<div class="player-name">
				<%= @player.name %>
			</div>
		</div>
	</div>
	<div class="two-thirds">
		<div id="player-stats">
			<table id="name-position">
				<tr>
					<td>
						<%= @player.name %>&nbsp;&nbsp;
					</td>
					<td id="position"><%= @player.position %></td>
				</tr>
			</table>
			<div class="ui-widget-header ui-corner-all stats-head">Season Stats</div>
			<%= render :partial => "season_stats" %>
			<div class="ui-widget-header ui-corner-all stats-head">Career Stats</div>
			<%= render :partial => "career_stats" %>
			<div class="ui-widget-header ui-corner-all stats-head">Player Bio</div>
			<%= render :partial => "bio" %>
		</div>
	</div>
</div>

<br />
<div class="score-board">
	<p class="validate-tips"></p>
	<table cellspacing="0" cellpadding="0">
		<thead>
			<%= render :partial => "games/score_board_header" %>
		</thead>
		<tbody>
			<%= render :partial => "games/form" %>
		</tbody>
		<tbody id="all-my-games" style="display:none">
			<%= render :partial => "games/game", :locals => {:games => @player.games } %>
		</tbody>
	</table>
</div>